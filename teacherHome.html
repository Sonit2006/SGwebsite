<html>

<head>
    <title> Student Genius</title>
    <link rel="stylesheet" href="teacherHomeStyles.css" type="text/css">
</head>

<body>
    <div id="wrapper">
        <div id="banner">
            <h1 align="center">Student Genius</h1>
        </div>
        <div id="main-content">
            <div id="updateBtn" align="right">
                <input type="button" align="center" id="update" onclick="navigate()" value="Update">
            </div>
            <div id="menu">
                <div class="left">
                    <li><input type="button" align="center" id="report" onclick="navigate()" value="Generate report">
                    </li>
                    <li><input type="button" align="center" id="winners" value="Show Winners"></li>
                </div>
                <div class="right">
                    <div id="box1">
                        <form>
                            <input type="search" id="searchInput" name="searchInput" placeholder="Search..."
                                oninput="filterDropdownOptions()">
                            <div id="dropdown" class="dropdown-content"></div>
                            <input type="submit" value="Search" />
                            <div id="result" align="center"></div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
        <div id="footer"></div>
    </div>
    <script src="https://cdn.botpress.cloud/webchat/v0/inject.js"></script>
    <script>
        window.botpressWebChat.init({
            "botId": "d7291e60-2ba1-4a68-b738-8c94b2b7056f",
            "hostUrl": "https://cdn.botpress.cloud/webchat/v0",
            "messagingUrl": "https://messaging.botpress.cloud",
            "clientId": "d7291e60-2ba1-4a68-b738-8c94b2b7056f",
            "showPoweredBy": true
        });
    </script>
    <script>
        const searchInput = document.getElementById('searchInput');
        const dropdown = document.getElementById('dropdown');

        var suggestions;

        fetch('http://localhost:3000/data')
            .then(response => response.json())
            .then(data => {
                suggestions = data.map(row => row.Name);
            })
            .catch(error => {
                // Handle any errors
                console.error(error);
            });

        function filterDropdownOptions() {
            const filterValue = searchInput.value.toLowerCase();
            dropdown.innerHTML = '';

            // Filter and display matching suggestions
            const matchingSuggestions = suggestions.filter(suggestion =>
                suggestion.toLowerCase().includes(filterValue)
            );

            matchingSuggestions.forEach(suggestion => {
                const suggestionElement = document.createElement('button');
                suggestionElement.type = 'button';
                suggestionElement.textContent = suggestion;
                suggestionElement.onclick = () => selectSuggestion(suggestion);

                dropdown.appendChild(suggestionElement);
            });

            if (matchingSuggestions.length > 0) {
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
        }

        function selectSuggestion(selectedSuggestion) {
            const display = document.getElementById("result");
            display.innerHTML = "";
            //fetch data and set searchinput.value to row.ID
            fetch('http://localhost:3000/getOtherColumns?value=' + encodeURIComponent(selectedSuggestion))
                .then(response => response.json())
                .then(data => {
                    const idHeader = document.createElement('h3');
                    const nameHeader = document.createElement('h3');
                    const gradeHeader = document.createElement('h3');
                    const pointHeader = document.createElement('h3');
                    // Process the data returned from the server
                    idHeader.textContent = "ID:  " + data[0].ID;
                    nameHeader.textContent = "Name:  " + data[0].Name;
                    gradeHeader.textContent = "Grade:  " + data[0].Grade;
                    pointHeader.textContent = "Points:  " + data[0].Points;
                    display.appendChild(idHeader);
                    display.appendChild(nameHeader);
                    display.appendChild(gradeHeader);
                    display.appendChild(pointHeader);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            searchInput.value = selectedSuggestion;
            dropdown.style.display = 'none';

        }
    </script>
</body>

</html>